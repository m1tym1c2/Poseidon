# user       www www;  ## Default: nobody
worker_processes  auto;  ## Default: 1
error_log  /var/log/nginx/error.log;
pid        /var/log/nginx/nginx.pid;
worker_rlimit_nofile 100000;

events {
  worker_connections  4096;  ## Default: 1024
  multi_accept on;
  use epoll;
}

http {
  # log_format   main '$remote_addr - $remote_user [$time_local]  $status '
  #   '"$request" $body_bytes_sent "$http_referer" '
  #   '"$http_user_agent" "$http_x_forwarded_for"';
  # access_log   /var/log/nginx/access.log  main;

  access_log  off;
  sendfile     on;
  tcp_nopush   on;
  tcp_nodelay on;
  aio          on;

  # server_names_hash_bucket_size 128; # this seems to be required for some vhosts

  open_file_cache max=200000 inactive=20s;
  open_file_cache_valid 30s;
  open_file_cache_min_uses 2;
  open_file_cache_errors on;
  
  gzip_min_length 10240;
  gzip_comp_level 1;
  gzip_vary on;
  gzip_disable msie6;
  gzip_proxied expired no-cache no-store private auth;
  gzip_types
      # text/html is always compressed by HttpGzipModule
      text/css
      text/javascript
      text/xml
      text/plain
      text/x-component
      application/javascript
      application/x-javascript
      application/json
      application/xml
      application/rss+xml
      application/atom+xml
      font/truetype
      font/opentype
      application/vnd.ms-fontobject
      image/svg+xml;

  reset_timedout_connection on;

  client_body_timeout 10;
  send_timeout 2;
  keepalive_timeout 30;
  keepalive_requests 100000;

  server {
    listen 80;
    server_name localhost;

    location /database/ {
      alias /database/;
    }

    location /keyframes/ {
        alias /database/keyframes/;
    }

    location /streaming/ {
        alias /database/videos/;
        types {
            application/vnd.apple.mpegurl m3u8;
            video/mp2t ts;
        }
        add_header 'Access-Control-Allow-Origin' '*';
    }
    }
}